from abc import ABC, abstractmethod
from pathlib import Path

from dcv_benchmark.models.metrics import SecurityMetrics


class BaseMetricsCalculator(ABC):
    """
    Abstract interface for computing experiment metrics from raw traces.

    Design Note:
        This class processes the `traces.jsonl` file directly from disk rather than
        accepting an in-memory list of objects. This design choice ensures:
        1. Scalability: We can process large datasets without O(N) memory usage.
        2. Re-analysis: We can tweak the metric calculation logic and re-run the
           reporting step instantly without re-executing the expensive LLM workload.
    """

    @abstractmethod
    def calculate(self, traces_path: Path) -> SecurityMetrics:
        """
        Parses the traces.jsonl file and calculates specific metrics.

        Args:
            traces_path: Path to the .jsonl file generated by the Runner.

        Returns:
            A SecurityMetrics object.
        """
        pass
